<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Java Online Console</title>

<style>
body{
  background:#111;
  color:#0f0;
  font-family:monospace;
  text-align:center;
}
#console{
  width:80%;
  height:420px;
  margin:20px auto;
  background:black;
  padding:15px;
  overflow:auto;
  white-space:pre-wrap;
  border-radius:8px;
  text-align:left;
}
button{
  padding:10px 20px;
  margin:5px;
  font-size:16px;
}
</style>
</head>

<body>

<h2>Java Cloud Console</h2>

<div id="programs"></div>
<div id="console">Type input below and press RUN.\n</div>

<script>

const API="https://throbbing-glitter-9b1e.donthulanithish53.workers.dev";
const consoleBox=document.getElementById("console");

let busy=false;

/* load buttons */
async function loadPrograms(){
  const r=await fetch(API+"/files");
  const files=await r.json();
  const box=document.getElementById("programs");

  files.forEach(f=>{
    const b=document.createElement("button");
    b.textContent=f;
    b.onclick=()=>runProgram(f);
    box.appendChild(b);
  });
}

/* run program */
async function runProgram(file){

  if(busy){
    consoleBox.textContent+="\nProgram already running...\n";
    return;
  }

  busy=true;

  // collect console input
  const input=prompt("Enter program input (multiple lines allowed):") || "";

  consoleBox.textContent="Starting "+file+"...\n";

  await fetch(API+"/run",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({filename:file,input:input})
  });

  let state="queued";

  while(state!=="completed"){
    await new Promise(r=>setTimeout(r,2500));
    const s=await fetch(API+"/status");
    state=await s.text();
    consoleBox.textContent+="status: "+state+"\n";
  }

  consoleBox.textContent+="Fetching output...\n";

  const out=await fetch(API+"/result?x="+Date.now());
  const txt=await out.text();

  consoleBox.textContent+="\n------ OUTPUT ------\n"+txt+"\n--------------------\n";

  busy=false;
}

loadPrograms();

</script>
</body>
</html>
