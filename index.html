<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Java Runner</title>

<style>
body{
    font-family: Arial;
    text-align:center;
    margin-top:80px;
    background:#f2f2f2;
}
h1{
    margin-bottom:40px;
}
button{
    display:block;
    margin:15px auto;
    padding:14px 28px;
    font-size:18px;
    background:green;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
button:hover{
    background:#0a7a0a;
}
#status{
    margin-top:20px;
    font-size:18px;
}
</style>
</head>

<body>

<h1>Available Java Programs</h1>

<div id="programs"></div>
<div id="status">Loading programs...</div>

<script>

const API = "https://throbbing-glitter-9b1e.donthulanithish53.workers.dev";

async function loadPrograms() {
    try {

        const res = await fetch(API + "/files", {
            method: "GET",
            mode: "cors",
            cache: "no-store",
            headers: {
                "Accept": "application/json"
            },
            referrerPolicy: "no-referrer"
        });

        const files = await res.json();

        const container = document.getElementById("programs");
        const status = document.getElementById("status");

        status.innerHTML = "";

        if(files.length === 0){
            status.innerHTML = "No Java files found.";
            return;
        }

        files.forEach(file => {
            const btn = document.createElement("button");
            btn.innerText = "Run " + file;

            btn.onclick = async () => {
                status.innerHTML = "Starting " + file + "...";

                await fetch(API + "/run", {
                    method: "POST",
                    mode: "cors",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ filename: file }),
                    referrerPolicy: "no-referrer"
                });

                status.innerHTML = file + " started. Check GitHub Actions.";
            };

            container.appendChild(btn);
        });

    } catch (e) {
        document.getElementById("status").innerHTML =
            "Failed to load programs.";
    }
}

loadPrograms();

</script>

</body>
</html>
