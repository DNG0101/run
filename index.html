<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Java Runner</title>

<style>
body{
    font-family: Arial;
    text-align:center;
    margin-top:80px;
    background:#f2f2f2;
}
button{
    display:block;
    margin:15px auto;
    padding:14px 28px;
    font-size:18px;
    background:green;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
pre{
    background:white;
    padding:15px;
    width:60%;
    margin:auto;
    border-radius:8px;
}
</style>
</head>

<body>

<h1>Available Java Programs</h1>
<div id="programs"></div>
<div id="status">Loading programs...</div>

<script>

const API = "https://throbbing-glitter-9b1e.donthulanithish53.workers.dev";

async function loadPrograms(){

    const status = document.getElementById("status");
    const container = document.getElementById("programs");

    try{

        const res = await fetch(API + "/files", {
            method: "GET",
            mode: "cors",
            cache: "no-store",
            headers: {
                "Accept": "application/json"
            }
        });

        if(!res.ok){
            status.innerHTML = "Server not responding (" + res.status + ")";
            return;
        }

        const files = await res.json();

        status.innerHTML = "";

        if(files.length === 0){
            status.innerHTML = "No Java programs found in repository.";
            return;
        }

        files.forEach(file => {

            const btn = document.createElement("button");
            btn.innerText = "Run " + file;

            btn.onclick = async () => {

                status.innerHTML = "Running " + file + " ... (15-25 seconds)";

                await fetch(API + "/run", {
                    method:"POST",
                    mode:"cors",
                    headers:{"Content-Type":"application/json"},
                    body: JSON.stringify({ filename:file })
                });

                await new Promise(r => setTimeout(r, 20000));

                const out = await fetch(API + "/result", { cache:"no-store" });
                const text = await out.text();

                status.innerHTML =
                    "<h3>Program Output:</h3><pre>"+text+"</pre>";
            };

            container.appendChild(btn);
        });

    }
    catch(err){
        status.innerHTML = "Cannot connect to Worker API";
        console.error(err);
    }
}

loadPrograms();

</script>
</body>
</html>
