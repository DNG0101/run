<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Java Runner</title>

<style>
body{
    font-family: Arial;
    text-align:center;
    margin-top:80px;
    background:#f2f2f2;
}
button{
    display:block;
    margin:12px auto;
    padding:14px 28px;
    font-size:18px;
    background:green;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
#output{
    width:70%;
    margin:20px auto;
    background:white;
    padding:20px;
    border-radius:10px;
    white-space:pre-wrap;
}
input{
    padding:12px;
    width:300px;
    font-size:16px;
    border-radius:8px;
    margin-bottom:20px;
}
</style>
</head>

<body>

<h1>Available Java Programs</h1>

<input id="userInput" placeholder="Enter input (example: 5 10 or Nithish)">

<div id="programs"></div>
<div id="status">Loading programs...</div>
<div id="output"></div>

<script>

const API = "https://throbbing-glitter-9b1e.donthulanithish53.workers.dev";
let running = false;

/* Load program buttons */
async function loadPrograms(){

    const res = await fetch(API + "/files?x=" + Date.now());
    const files = await res.json();

    const container = document.getElementById("programs");
    const status = document.getElementById("status");

    status.innerHTML = "";

    files.forEach(file=>{
        const btn = document.createElement("button");
        btn.innerText = "Run " + file;
        btn.onclick = ()=> runProgram(file);
        container.appendChild(btn);
    });
}

/* Run selected program */
async function runProgram(file){

    if(running){
        alert("A program is already running. Please wait.");
        return;
    }

    running = true;

    const status = document.getElementById("status");
    const output = document.getElementById("output");
    const input = document.getElementById("userInput").value;

    status.innerHTML = "Starting program...";
    output.innerHTML = "";

    await fetch(API + "/run",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({ filename:file, input:input })
    });

    let state="queued";

    while(state !== "completed"){
        await new Promise(r=>setTimeout(r,3000));
        const res = await fetch(API + "/status?x=" + Date.now());
        state = await res.text();
        status.innerHTML = "Runner status: " + state;
    }

    const out = await fetch(API + "/result?x=" + Date.now());
    const text = await out.text();

    status.innerHTML = "Finished";
    output.innerText = text;

    running = false;
}

loadPrograms();

</script>
</body>
</html>
