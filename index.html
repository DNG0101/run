<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Java Online Console</title>

<style>
body{
  background:#111;
  color:#0f0;
  font-family:monospace;
  text-align:center;
}

#console{
  width:85%;
  height:460px;
  margin:20px auto;
  background:black;
  padding:15px;
  overflow:auto;
  white-space:pre-wrap;
  border-radius:8px;
  text-align:left;
  border:2px solid #0f0;
}

button{
  padding:10px 18px;
  margin:5px;
  font-size:15px;
  background:#222;
  color:#0f0;
  border:1px solid #0f0;
  cursor:pointer;
}
button:hover{background:#333}
</style>
</head>

<body>

<h2>Java Cloud Console</h2>

<div id="programs"></div>
<div id="console">Ready.\n</div>

<script>

const API="https://throbbing-glitter-9b1e.donthulanithish53.workers.dev";
const consoleBox=document.getElementById("console");

let busy=false;

/* load program buttons */
async function loadPrograms(){
  const r=await fetch(API+"/files");
  const files=await r.json();
  const box=document.getElementById("programs");

  files.forEach(f=>{
    const b=document.createElement("button");
    b.textContent=f;
    b.onclick=()=>runProgram(f);
    box.appendChild(b);
  });
}

function write(txt){
  consoleBox.textContent+=txt;
  consoleBox.scrollTop=consoleBox.scrollHeight;
}

/* run program */
async function runProgram(file){

  if(busy){
    write("\nAnother program is running...\n");
    return;
  }

  busy=true;
  consoleBox.textContent="";

  const input=prompt("Enter input (multiple lines allowed):")||"";

  write("Running "+file+"\n");

  const r=await fetch(API+"/run",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({filename:file,input:input})
  });

  const runid=await r.text();

  write("Run ID: "+runid+"\nWaiting for runner...\n");

  await new Promise(r=>setTimeout(r,6000));

  let status="queued";

  while(status!=="completed"){
    await new Promise(r=>setTimeout(r,5000));
    const s=await fetch(API+"/status?id="+runid);
    status=await s.text();
    write("status: "+status+"\n");
  }

  write("Fetching output...\n");

  let output="waiting...";
  while(output==="waiting..."){
    await new Promise(r=>setTimeout(r,3000));
    const out=await fetch(API+"/result?id="+runid);
    output=await out.text();
  }

  write("\n----- PROGRAM OUTPUT -----\n");
  write(output);
  write("\n--------------------------\n");

  busy=false;
}

loadPrograms();

</script>
</body>
</html>
