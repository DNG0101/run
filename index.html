<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Java Console</title>

<style>
body{font-family:monospace;background:#111;color:#0f0;text-align:center}
#console{
  width:80%;
  height:400px;
  margin:20px auto;
  background:black;
  padding:15px;
  overflow:auto;
  border-radius:10px;
  text-align:left;
  white-space:pre-wrap;
}
button{padding:10px 20px;margin:5px;font-size:16px}
input{padding:8px;width:300px;margin:10px}
</style>
</head>

<body>

<h2>Online Java Console</h2>

<input id="input" placeholder="Enter program input">

<div id="programs"></div>

<div id="console">Ready.</div>

<script>

const API="https://throbbing-glitter-9b1e.donthulanithish53.workers.dev";
let busy=false;

function log(msg){
  const c=document.getElementById("console");
  c.textContent+= "\n"+msg;
  c.scrollTop=c.scrollHeight;
}

async function loadPrograms(){
  const r=await fetch(API+"/files");
  const files=await r.json();

  const box=document.getElementById("programs");

  files.forEach(f=>{
    const b=document.createElement("button");
    b.textContent=f;
    b.onclick=()=>run(f);
    box.appendChild(b);
  });
}

async function run(file){

  if(busy){
    log("Another program is already running...");
    return;
  }

  busy=true;
  document.getElementById("console").textContent="";

  const input=document.getElementById("input").value;

  log("Starting "+file);

  await fetch(API+"/run",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({filename:file,input:input})
  });

  let state="queued";

  while(state!=="completed"){
    await new Promise(r=>setTimeout(r,2500));
    const s=await fetch(API+"/status");
    state=await s.text();
    log("status: "+state);
  }

  log("Fetching output...");
  const out=await fetch(API+"/result?x="+Date.now());
  const txt=await out.text();

  log("\n--- PROGRAM OUTPUT ---\n"+txt+"\n----------------------");

  busy=false;
}

loadPrograms();

</script>

</body>
</html>
