<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Java Runner</title>

<style>
body{
    font-family: Arial;
    text-align:center;
    margin-top:80px;
    background:#f2f2f2;
}
h1{
    margin-bottom:40px;
}
button{
    display:block;
    margin:12px auto;
    padding:14px 28px;
    font-size:18px;
    background:green;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
button:hover{
    background:#0a7a0a;
}
#status{
    margin-top:25px;
    font-size:18px;
}
#output{
    margin:25px auto;
    width:70%;
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 2px 10px rgba(0,0,0,0.2);
    white-space:pre-wrap;
    text-align:left;
}
input{
    padding:12px;
    width:300px;
    font-size:16px;
    border-radius:8px;
    border:1px solid #ccc;
    margin-bottom:20px;
}
</style>
</head>

<body>

<h1>Available Java Programs</h1>

<!-- USER INPUT -->
<input id="userInput" placeholder="Enter input (example: Nithish or 5 10)">

<div id="programs"></div>

<div id="status">Loading programs...</div>
<div id="output"></div>

<script>

const API = "https://throbbing-glitter-9b1e.donthulanithish53.workers.dev";

/* ---------------- LOAD FILES ---------------- */
async function loadPrograms() {

    const container = document.getElementById("programs");
    const status = document.getElementById("status");

    try {
        const res = await fetch(API + "/files?x=" + Date.now());
        const files = await res.json();

        status.innerHTML = "";

        files.forEach(file => {

            const btn = document.createElement("button");
            btn.innerText = "Run " + file;

            btn.onclick = async () => runProgram(file);

            container.appendChild(btn);
        });

    } catch(e){
        status.innerHTML = "Failed to load programs.";
    }
}

/* ---------------- RUN PROGRAM ---------------- */
async function runProgram(file){

    const status = document.getElementById("status");
    const output = document.getElementById("output");
    const inputBox = document.getElementById("userInput");

    const userInput = inputBox.value || "";

    status.innerHTML = "Preparing to run " + file + "...";
    output.innerHTML = "";

    /* SEND REQUEST TO WORKER */
    await fetch(API + "/run", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            filename: file,
            input: userInput
        })
    });

    /* WAIT FOR GITHUB RUNNER */
    let state = "queued";

    while(state !== "completed"){

        await new Promise(r => setTimeout(r, 4000));

        const res = await fetch(API + "/status?x=" + Date.now());
        state = await res.text();

        status.innerHTML = "Runner status: " + state;
    }

    /* FETCH OUTPUT */
    status.innerHTML = "Fetching output...";

    const out = await fetch(API + "/result?x=" + Date.now());
    const text = await out.text();

    status.innerHTML = "Program Output:";
    output.innerText = text;
}

/* START */
loadPrograms();

</script>

</body>
</html>
